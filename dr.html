<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€í˜œì˜ ìš© ë“œë¡œì‰ ì—°ìŠµì‹¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body.fullscreen-active { overflow: hidden; }
        body.bw-mode img { filter: grayscale(100%) contrast(1.1); }
        body.bw-mode .img-card:hover img { filter: grayscale(0%); }
        
        .img-card { opacity: 0; transform: translateY(10px); transition: all 0.5s ease; border: 1px solid rgba(255,255,255,0.05); }
        .img-card.loaded { opacity: 1; transform: translateY(0); }
        .loader { border-top-color: #3b82f6; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .dragon-gradient { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-[#050505] text-gray-200 min-h-screen p-4 sm:p-10 font-sans">

    <header class="max-w-7xl mx-auto mb-10 border-b border-white/10 pb-8">
        <div class="flex flex-col lg:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-3">
                <span class="text-3xl">ğŸ²</span>
                <div>
                    <h1 class="text-2xl font-black tracking-tight dragon-gradient">ì§€í˜œì˜ ìš© <span class="text-gray-300 font-light">ë“œë¡œì‰ ì—°ìŠµì‹¤</span></h1>
                    <p id="statusText" class="text-[9px] text-gray-600 mt-1 uppercase tracking-[0.2em] font-mono">System Active: High-Precision Search</p>
                </div>
            </div>

            <div class="flex flex-wrap justify-center items-center gap-3">
                <input type="text" id="customSearch" placeholder="íŠ¹ì • í‚¤ì›Œë“œ (ì˜ˆ: ballet)" 
                       class="bg-gray-900 border border-gray-800 rounded-full px-5 py-2 text-sm focus:ring-2 focus:ring-blue-600 outline-none w-44">
                
                <select id="gender" class="bg-gray-900 border border-gray-800 rounded-full px-4 py-2 text-sm outline-none cursor-pointer">
                    <option value="female solo model">ì—¬ì„± (Woman Only)</option>
                    <option value="male solo model">ë‚¨ì„± (Man Only)</option>
                    <option value="person solo">ëª¨ë‘ (Mixed)</option>
                </select>
                
                <select id="pose" class="bg-gray-900 border border-gray-800 rounded-full px-4 py-2 text-sm outline-none cursor-pointer">
                    <option value="artistic muscular anatomy photography">Anatomy (ê·¼ìœ¡)</option>
                    <option value="full body standing pose">Full Body (ì „ì‹ )</option>
                    <option value="portrait face close-up">Portrait (ì–¼êµ´)</option>
                    <option value="dynamic action movement">Action (ì—­ë™)</option>
                </select>

                <button onclick="toggleBW()" id="bwBtn" class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-full text-xs font-bold transition border border-gray-600">
                    B&W OFF
                </button>

                <button onclick="fetchThreeImages()" class="bg-blue-600 hover:bg-blue-500 text-white px-8 py-2 rounded-full font-bold transition-all active:scale-95 shadow-lg shadow-blue-900/40">
                    ìƒˆ ëª¨ë¸ ì„­ì™¸
                </button>
            </div>
        </div>
    </header>

    <main id="imageGrid" class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-7xl mx-auto mb-20">
        </main>

    <section class="max-w-7xl mx-auto border-t border-white/5 pt-10 mb-10">
        <h2 class="text-[10px] font-bold tracking-[0.4em] text-gray-700 mb-6 uppercase">Pinned References</h2>
        <div id="pinContainer" class="flex gap-4 overflow-x-auto pb-4 scrollbar-hide min-h-[140px]">
            <p id="pinPlaceholder" class="text-gray-800 italic text-xs self-center w-full text-center">ë§ˆìŒì— ë“œëŠ” ìë£Œë¥¼ í•€ìœ¼ë¡œ ê³ ì •í•˜ì„¸ìš”.</p>
        </div>
    </section>

    <div id="overlay" class="fixed inset-0 z-50 bg-black/98 hidden items-center justify-center p-4 cursor-zoom-out" onclick="closeFS()">
        <img id="overlayImg" src="" class="max-w-full max-h-full object-contain">
    </div>

    <script>
        const API_KEY = 'GyPRdtANcIlgVwBA0UyGKyXnXfjIExjZdVfprscf3SocW5Ik9Ic2xWmX';
        const grid = document.getElementById('imageGrid');
        const pinContainer = document.getElementById('pinContainer');
        const statusText = document.getElementById('statusText');
        let pinnedImages = JSON.parse(localStorage.getItem('pinnedRefs')) || [];

        window.onload = () => {
            renderPins();
            fetchThreeImages();
        };

        function toggleBW() {
            const isBW = document.body.classList.toggle('bw-mode');
            const btn = document.getElementById('bwBtn');
            btn.innerText = isBW ? "B&W ON" : "B&W OFF";
            btn.className = isBW 
                ? "bg-white text-black px-4 py-2 rounded-full text-xs font-bold transition border border-white" 
                : "bg-gray-800 text-white px-4 py-2 rounded-full text-xs font-bold transition border border-gray-600";
        }

        async function fetchThreeImages() {
            statusText.innerText = "Searching for precise references...";
            grid.innerHTML = '<div class="col-span-full flex justify-center py-20"><div class="loader w-10 h-10 border-4 border-gray-800 rounded-full"></div></div>';
            
            const gender = document.getElementById('gender').value;
            const pose = document.getElementById('pose').value;
            const custom = document.getElementById('customSearch').value;
            
            // ì •ë°€ë„ í–¥ìƒì„ ìœ„í•œ ì¿¼ë¦¬ ì¡°í•©
            let query = custom ? `${custom} solo` : `${gender} ${pose}`;
            
            // Anatomy ëª¨ë“œì¼ ë•Œì˜ ë³„ë„ ìµœì í™”
            if (pose.includes("anatomy")) {
                query = `${gender} muscular physique artistic`;
            }

            const randomPage = Math.floor(Math.random() * 60) + 1;
            const url = `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=20&page=${randomPage}`;

            try {
                const response = await fetch(url, { headers: { 'Authorization': API_KEY } });
                const data = await response.json();
                
                // ê²°ê³¼ ì¤‘ ì„±ë³„ í‚¤ì›Œë“œê°€ ì •í™•íˆ í¬í•¨ëœ ì‚¬ì§„ ìœ„ì£¼ë¡œ í•œ ë²ˆ ë” í•„í„°ë§ (ì„ íƒ ì‚¬í•­)
                if (data.photos && data.photos.length >= 3) {
                    const shuffled = data.photos.sort(() => 0.5 - Math.random());
                    renderGrid(shuffled.slice(0, 3));
                    statusText.innerText = `Matched: ${query}`;
                } else {
                    statusText.innerText = "No precise match. Try different keywords.";
                    grid.innerHTML = '<p class="col-span-full text-center py-10 text-gray-700 font-light underline">ì¼ì¹˜í•˜ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ë³€ê²½í•´ ì£¼ì„¸ìš”.</p>';
                }
            } catch (error) {
                statusText.innerText = "Connection lost.";
            }
        }

        function renderGrid(photos) {
            grid.innerHTML = '';
            photos.forEach(photo => {
                const card = document.createElement('div');
                card.className = 'img-card relative bg-[#0a0a0a] rounded-sm overflow-hidden aspect-[3/4] group';
                
                card.innerHTML = `
                    <img src="${photo.src.large}" class="w-full h-full object-cover cursor-zoom-in group-hover:scale-110 transition-all duration-1000 ease-in-out" 
                         onclick="openFS('${photo.src.original}')" onload="this.parentElement.classList.add('loaded')">
                    
                    <button onclick="pinImage('${photo.src.large}', '${photo.src.original}')" 
                            class="absolute top-4 right-4 bg-white/10 hover:bg-blue-600 text-white p-2.5 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10 backdrop-blur-md">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-3.5 h-3.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" />
                        </svg>
                    </button>
                    
                    <div class="absolute bottom-0 inset-x-0 p-3 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex justify-between items-center">
                        <span class="text-[8px] text-gray-500 uppercase font-mono">${photo.photographer}</span>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function pinImage(thumb, original) {
            if (pinnedImages.some(img => img.original === original)) return;
            pinnedImages.unshift({ thumb, original });
            if (pinnedImages.length > 12) pinnedImages.pop();
            saveAndRenderPins();
        }

        function unpinImage(original) {
            pinnedImages = pinnedImages.filter(img => img.original !== original);
            saveAndRenderPins();
        }

        function saveAndRenderPins() {
            localStorage.setItem('pinnedRefs', JSON.stringify(pinnedImages));
            renderPins();
        }

        function renderPins() {
            if (pinnedImages.length === 0) {
                document.getElementById('pinPlaceholder').classList.remove('hidden');
                pinContainer.innerHTML = '';
                return;
            }
            document.getElementById('pinPlaceholder').classList.add('hidden');
            pinContainer.innerHTML = pinnedImages.map(img => `
                <div class="relative flex-shrink-0 group">
                    <img src="${img.thumb}" class="h-28 w-20 object-cover rounded shadow-2xl cursor-zoom-in" onclick="openFS('${img.original}')">
                    <button onclick="unpinImage('${img.original}')" class="absolute -top-1.5 -right-1.5 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
                          <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        function openFS(src) {
            document.getElementById('overlayImg').src = src;
            document.getElementById('overlay').classList.replace('hidden', 'flex');
            document.body.classList.add('fullscreen-active');
        }

        function closeFS() {
            document.getElementById('overlay').classList.replace('flex', 'hidden');
            document.body.classList.remove('fullscreen-active');
        }
    </script>
</body>
</html>
